#!/usr/bin/env python
# -*- coding=utf-8 -*-
import json
import time
from enum import Enum
from vulnerability_database import VulnerabilityDatabase

RISK = Enum('RISK', ('INFO', 'LOW', 'MEDIUM', 'HIGH'))


class Reference(object):
    def __init__(self, location="", detail=""):
        self.location = location
        self.detail = detail

    def to_dict(self):
        return dict(location=self.location,
                    detail=self.description)

    def to_json(self):
        return json.dumps(self.to_dict())


class Vulnerability(object):
    def __init__(self, target_apk=None, name=None, description=None, solution=None, vul_type=None, risk_level=None,
                 plugin_name=None):
        self.target_apk = target_apk
        self.name = name  # 漏洞类型
        self.description = description  # 漏洞介绍
        self.solution = solution  # 解决方案
        self.vul_type = vul_type  # 漏洞类型id
        self.risk_level = risk_level  # 危险等级 0-4
        self.update_time = int(time.time())  # 扫描时间
        self.plugin_name = plugin_name
        self.reference = []  # 关于此Vul的所有发生位置

    def to_dict(self):
        return dict(
            target_apk=self.target_apk,  # 任务id由 -t id/--target id 指定
            name=self.name,  # 漏洞类型
            description=self.description,  # 漏洞介绍
            solution=self.solution,  # 解决方案
            vulType=self.vul_type,  # 漏洞类型id
            source=self.source,  # Scanner类型
            riskLevel=self.risk_level,  # 危险等级 0-4
            updateTime=self.update_time,  # 扫描时间
            reference=map(lambda x: x.to_dict(), self.reference),  # 关于此Vul的所有发生位置
        )

    def to_json(self):
        return json.dumps(self.to_dict())


if __name__ == '__main__':
    pass
